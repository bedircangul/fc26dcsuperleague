<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - EA FC 26</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #0a2351 0%, #1a4b8c 50%, #0a2351 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container { max-width: 1400px; margin: 0 auto; }
    
    .login-box {
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      max-width: 400px;
      margin: 100px auto;
      text-align: center;
    }
    
    .login-box h2 { 
      margin-bottom: 25px; 
      color: #0a2351;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 32px;
      letter-spacing: 2px;
    }
    
    .login-box input {
      width: 100%;
      padding: 15px;
      margin-bottom: 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }
    
    .login-box button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #1a4b8c 0%, #0d5fcc 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      font-weight: 700;
      font-family: 'Bebas Neue', sans-serif;
      letter-spacing: 1px;
    }
    
    .error { color: #dc3545; margin-top: 10px; }
    .hidden { display: none; }
    
    .header {
      background: rgba(255,255,255,0.95);
      padding: 20px 30px;
      border-radius: 15px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    
    h1 {
      color: #0a2351;
      font-size: 36px;
      margin: 0;
      font-family: 'Bebas Neue', sans-serif;
      letter-spacing: 2px;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      background: rgba(255,255,255,0.08);
      padding: 12px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    
    .tab-btn {
      flex: 1;
      padding: 18px;
      background: rgba(255,255,255,0.05);
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      color: rgba(255,255,255,0.7);
      font-family: 'Bebas Neue', sans-serif;
      letter-spacing: 1px;
    }
    
    .tab-btn.active {
      background: linear-gradient(135deg, #1a4b8c 0%, #0d5fcc 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(26, 75, 140, 0.6);
    }
    
    .tab-content {
      display: none;
      background: rgba(255,255,255,0.95);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    
    .tab-content.active { display: block; }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.3s;
      font-family: 'Roboto', sans-serif;
    }
    
    .btn:hover { opacity: 0.9; transform: translateY(-2px); }
    
    .btn-logout { background: #dc3545; color: white; }
    .btn-primary { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3); }
    .btn-secondary { background: #6c757d; color: white; }
    .btn-warning { background: #ffc107; color: #333; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-info { background: #17a2b8; color: white; }
    .btn-add { background: linear-gradient(135deg, #1a4b8c 0%, #0d5fcc 100%); color: white; box-shadow: 0 4px 12px rgba(26, 75, 140, 0.4); }
    
    .section {
      margin-bottom: 35px;
    }
    
    .section h3 {
      color: #0a2351;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 3px solid #1a4b8c;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 28px;
      letter-spacing: 1px;
    }
    
    .draw-item {
      background: #f8f9fa;
      padding: 20px;
      margin-bottom: 15px;
      border-radius: 10px;
      border-left: 5px solid #1a4b8c;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .draw-item-row {
      display: grid;
      grid-template-columns: 150px 1fr 1fr 100px;
      gap: 15px;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .draw-item label {
      font-weight: 700;
      color: #0a2351;
    }
    
    .draw-item input, .draw-item select {
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: 6px;
      font-size: 14px;
      background: white;
    }
    
    .logo-input {
      grid-column: 2 / 4;
    }
    
    .logo-preview {
      width: 50px;
      height: 50px;
      object-fit: contain;
      border: 2px solid #dee2e6;
      border-radius: 6px;
      padding: 5px;
      background: white;
    }
    
    .match-item {
      background: #f8f9fa;
      padding: 25px;
      margin-bottom: 20px;
      border-radius: 10px;
      border-left: 5px solid #1a4b8c;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .match-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .match-title {
      font-size: 18px;
      font-weight: 700;
      color: #0a2351;
      font-family: 'Bebas Neue', sans-serif;
      letter-spacing: 1px;
    }
    
    .match-week {
      background: linear-gradient(135deg, #1a4b8c 0%, #0d5fcc 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 700;
      font-family: 'Bebas Neue', sans-serif;
    }
    
    .match-controls {
      display: grid;
      grid-template-columns: 2fr 140px 100px 180px;
      gap: 15px;
      align-items: center;
    }
    
    .match-teams {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .match-teams select {
      flex: 1;
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: 6px;
      font-size: 14px;
      background: white;
    }
    
    .match-score {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .match-score input {
      width: 55px;
      padding: 12px 8px;
      text-align: center;
      border: 2px solid #dee2e6;
      border-radius: 6px;
      font-size: 20px;
      font-weight: 700;
      font-family: 'Bebas Neue', sans-serif;
    }
    
    .match-week-input {
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: 6px;
      font-size: 14px;
      text-align: center;
      font-weight: 700;
    }
    
    .match-actions {
      display: flex;
      gap: 8px;
    }
    
    .success-msg {
      background: #d4edda;
      color: #155724;
      padding: 12px;
      border-radius: 6px;
      margin-top: 15px;
      display: none;
      font-weight: 600;
    }
    
    .preview-box {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 10px;
      margin-top: 20px;
      border: 2px solid #1a4b8c;
    }
    
    .preview-box h4 {
      color: #1a4b8c;
      margin-bottom: 15px;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 24px;
      letter-spacing: 1px;
    }
    
    @media (max-width: 768px) {
      .match-controls, .draw-item-row {
        grid-template-columns: 1fr;
      }
      .tabs {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div id="login-screen" class="login-box">
    <h2>üîê Admin Giri≈üi</h2>
    <input type="password" id="admin-password" placeholder="Admin ≈ûifresi" onkeypress="if(event.key==='Enter') login()">
    <button onclick="login()">Giri≈ü Yap</button>
    <div id="login-error" class="error"></div>
  </div>

  <div id="admin-screen" class="hidden">
    <div class="container">
      <div class="header">
        <h1>‚öôÔ∏è Turnuva Admin Paneli</h1>
        <button class="btn btn-logout" onclick="logout()">√áƒ±kƒ±≈ü Yap</button>
      </div>
      
      <div class="tabs">
        <button class="tab-btn active" data-tab="draw">üé≤ Kura Y√∂netimi</button>
        <button class="tab-btn" data-tab="fixtures">üìã Fikst√ºr Y√∂netimi</button>
        <button class="tab-btn" data-tab="preview">üëÅÔ∏è √ñnizleme</button>
      </div>

      <div id="draw-content" class="tab-content active">
        <div class="section">
          <h3>
            <span>Takƒ±m & Oyuncu Y√∂netimi</span>
            <button class="btn btn-add" onclick="addDrawEntry()">‚ûï Yeni Ekle</button>
          </h3>
          <p style="color: #666; margin-bottom: 20px;">
            Oyuncu adƒ±, takƒ±m adƒ± ve takƒ±m logosu URL'sini girin. Logo URL'si i√ßin: takƒ±m logosuna saƒü tƒ±k ‚Üí "Resim Adresini Kopyala"
          </p>
          <div id="draw-list"></div>
          <button class="btn btn-primary" onclick="saveDraw()" style="margin-top: 20px; font-size: 16px; padding: 15px 30px;">
            üíæ T√ºm Deƒüi≈üiklikleri Kaydet
          </button>
          <div id="draw-msg" class="success-msg"></div>
        </div>
      </div>

      <div id="fixtures-content" class="tab-content">
        <div class="section">
          <h3>
            <span>Ma√ßlar</span>
            <button class="btn btn-add" onclick="addNewMatch()">‚ûï Yeni Ma√ß Ekle</button>
          </h3>
          <div id="matches-list"></div>
        </div>
      </div>

      <div id="preview-content" class="tab-content">
        <div class="section">
          <h3>üëÅÔ∏è Kullanƒ±cƒ±larƒ±n G√∂rd√ºƒü√º Sayfa</h3>
          <p style="color: #666; margin-bottom: 20px;">
            Bu, kullanƒ±cƒ±larƒ±n public sayfada g√∂rd√ºƒü√º i√ßerik. Deƒüi≈üiklikler otomatik yansƒ±r.
          </p>
          
          <div class="preview-box">
            <h4>üé≤ Kura</h4>
            <div id="preview-draw" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
              <div style="text-align: center; color: #999;">Y√ºkleniyor...</div>
            </div>
          </div>
          
          <div class="preview-box">
            <h4>üìã Fikst√ºr (Son 10 Ma√ß)</h4>
            <div id="preview-fixtures">
              <div style="text-align: center; color: #999;">Y√ºkleniyor...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const SUPABASE_URL = 'https://lioopzsrruwxudwptqer.supabase.co'
    const SUPABASE_SERVICE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxpb29wenNycnV3eHVkd3B0cWVyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2OTc2NzgxNywiZXhwIjoyMDg1MzQzODE3fQ.xUcopV1TEzrXmVAKLyKP-xfgfNNGyg4KLCIwZdzBQEs'
    const ADMIN_PASSWORD = 'TurnuvaBedircan2024!'

    let adminSupabase = null
    let drawEntries = []

    function login() {
      const password = document.getElementById('admin-password').value
      if (password === ADMIN_PASSWORD) {
        localStorage.setItem('admin-logged-in', 'true')
        adminSupabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY)
        showAdminPanel()
      } else {
        document.getElementById('login-error').textContent = 'Hatalƒ± ≈üifre!'
      }
    }

    function logout() {
      localStorage.removeItem('admin-logged-in')
      location.reload()
    }

    function showAdminPanel() {
      document.getElementById('login-screen').classList.add('hidden')
      document.getElementById('admin-screen').classList.remove('hidden')
      loadDrawData()
      loadMatches()
      loadPreview()
    }

    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const targetTab = this.getAttribute('data-tab')
        
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'))
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'))
        
        this.classList.add('active')
        document.getElementById(targetTab + '-content').classList.add('active')
        
        if (targetTab === 'preview') {
          loadPreview()
        }
      })
    })

    async function loadDrawData() {
      const { data } = await adminSupabase.from('draw').select('*').order('player_name')
      drawEntries = data || []
      
      if (drawEntries.length === 0) {
        drawEntries = [{ player_name: '', team_name: '', team_logo: '' }]
      }
      
      renderDraw()
    }

    function addDrawEntry() {
      drawEntries.push({ player_name: '', team_name: '', team_logo: '' })
      renderDraw()
    }

    function removeDrawEntry(index) {
      if (confirm('Bu giri≈üi silmek istediƒüinizden emin misiniz?')) {
        drawEntries.splice(index, 1)
        renderDraw()
      }
    }

    function renderDraw() {
      const html = drawEntries.map((entry, index) => `
        <div class="draw-item">
          <div class="draw-item-row">
            <label>Oyuncu</label>
            <input type="text" id="player-${index}" value="${entry.player_name || ''}" placeholder="Oyuncu adƒ±">
            <input type="text" id="team-${index}" value="${entry.team_name || ''}" placeholder="Takƒ±m adƒ±">
            <button class="btn btn-danger" onclick="removeDrawEntry(${index})">üóëÔ∏è</button>
          </div>
          <div class="draw-item-row">
            <label>Logo URL</label>
            <input type="text" id="logo-${index}" class="logo-input" value="${entry.team_logo || ''}" 
                   placeholder="https://example.com/logo.png" onchange="updateLogoPreview(${index})">
            <img id="logo-preview-${index}" src="${entry.team_logo || ''}" class="logo-preview" 
                 onerror="this.style.display='none'" style="${entry.team_logo ? '' : 'display:none'}">
          </div>
        </div>
      `).join('')
      
      document.getElementById('draw-list').innerHTML = html
    }

    function updateLogoPreview(index) {
      const logoUrl = document.getElementById(`logo-${index}`).value
      const preview = document.getElementById(`logo-preview-${index}`)
      if (logoUrl) {
        preview.src = logoUrl
        preview.style.display = 'block'
      } else {
        preview.style.display = 'none'
      }
    }

    async function saveDraw() {
      const updates = []
      
      for (let i = 0; i < drawEntries.length; i++) {
        const playerName = document.getElementById(`player-${i}`).value.trim()
        const teamName = document.getElementById(`team-${i}`).value.trim()
        const logoUrl = document.getElementById(`logo-${i}`).value.trim()
        
        if (playerName && teamName) {
          updates.push({
            player_name: playerName,
            team_name: teamName,
            team_logo: logoUrl || null
          })
        }
      }
      
      if (updates.length === 0) {
        alert('L√ºtfen en az bir oyuncu ve takƒ±m girin!')
        return
      }
      
      try {
        await adminSupabase.from('draw').delete().neq('id', 0)
        
        const { error } = await adminSupabase.from('draw').insert(updates)
        if (error) throw error
        
        showDrawMessage('‚úÖ T√ºm deƒüi≈üiklikler kaydedildi!')
        await loadDrawData()
        setTimeout(loadPreview, 1000)
      } catch (error) {
        console.error('Kayƒ±t hatasƒ±:', error)
        alert('Hata: ' + error.message)
      }
    }

    function showDrawMessage(text) {
      const msg = document.getElementById('draw-msg')
      msg.textContent = text
      msg.style.display = 'block'
      setTimeout(() => msg.style.display = 'none', 3000)
    }

    async function loadMatches() {
      const { data } = await adminSupabase.from('matches').select('*').order('week_number, id')
      const { data: drawData } = await adminSupabase.from('draw').select('*')
      
      const teamList = drawData && drawData.length > 0 ? drawData.map(d => d.team_name) : []
      
      const html = (data || []).map(match => `
        <div class="match-item" id="match-${match.id}">
          <div class="match-header">
            <div class="match-title">Ma√ß #${match.id}</div>
            <div class="match-week">Hafta ${match.week_number || 1}</div>
          </div>
          
          <div class="match-controls">
            <div class="match-teams">
              <select id="home-team-${match.id}">
                ${teamList.map(team => `
                  <option value="${team}" ${team === match.home_team ? 'selected' : ''}>${team}</option>
                `).join('')}
              </select>
              <span style="font-weight: bold; color: #1a4b8c;">VS</span>
              <select id="away-team-${match.id}">
                ${teamList.map(team => `
                  <option value="${team}" ${team === match.away_team ? 'selected' : ''}>${team}</option>
                `).join('')}
              </select>
            </div>
            
            <div class="match-score">
              <input type="number" id="home-score-${match.id}" 
                     value="${match.home_score !== null ? match.home_score : ''}" 
                     placeholder="0" min="0" max="99">
              <span style="font-weight: bold;">-</span>
              <input type="number" id="away-score-${match.id}" 
                     value="${match.away_score !== null ? match.away_score : ''}" 
                     placeholder="0" min="0" max="99">
            </div>
            
            <input type="number" id="week-${match.id}" class="match-week-input" 
                   value="${match.week_number || 1}" min="1" max="50" placeholder="Hafta">
            
            <div class="match-actions">
              <button class="btn btn-primary" onclick="saveMatch(${match.id})">üíæ</button>
              <button class="btn btn-warning" onclick="resetMatch(${match.id})">üîÑ</button>
              <button class="btn btn-danger" onclick="deleteMatch(${match.id})">üóëÔ∏è</button>
            </div>
          </div>
          
          <div id="msg-${match.id}" class="success-msg"></div>
        </div>
      `).join('')
      
      document.getElementById('matches-list').innerHTML = html || '<p style="color: #666;">Hen√ºz ma√ß yok.</p>'
    }

    async function addNewMatch() {
      const { data: drawData } = await adminSupabase.from('draw').select('*')
      const teamList = drawData && drawData.length >= 2 ? drawData.map(d => d.team_name) : []
      
      if (teamList.length < 2) {
        alert('L√ºtfen √∂nce en az 2 takƒ±m ekleyin!')
        return
      }
      
      try {
        const { error } = await adminSupabase.from('matches').insert({
          home_team: teamList[0],
          away_team: teamList[1],
          week_number: 1
        })
        
        if (error) throw error
        await loadMatches()
      } catch (error) {
        alert('Hata: ' + error.message)
      }
    }

    async function saveMatch(matchId) {
      const homeTeam = document.getElementById(`home-team-${matchId}`).value
      const awayTeam = document.getElementById(`away-team-${matchId}`).value
      const homeScore = document.getElementById(`home-score-${matchId}`).value
      const awayScore = document.getElementById(`away-score-${matchId}`).value
      const week = document.getElementById(`week-${matchId}`).value

      try {
        const { error } = await adminSupabase.from('matches').update({
          home_team: homeTeam,
          away_team: awayTeam,
          home_score: homeScore === '' ? null : parseInt(homeScore),
          away_score: awayScore === '' ? null : parseInt(awayScore),
          week_number: parseInt(week) || 1
        }).eq('id', matchId)

        if (error) throw error
        showMatchMessage(matchId, '‚úÖ Kaydedildi!')
        setTimeout(loadPreview, 1000)
      } catch (error) {
        alert('Hata: ' + error.message)
      }
    }

    async function resetMatch(matchId) {
      if (!confirm('Skoru sƒ±fƒ±rlamak istediƒüinizden emin misiniz?')) return

      try {
        const { error } = await adminSupabase.from('matches').update({ 
          home_score: null, 
          away_score: null 
        }).eq('id', matchId)

        if (error) throw error
        document.getElementById(`home-score-${matchId}`).value = ''
        document.getElementById(`away-score-${matchId}`).value = ''
        showMatchMessage(matchId, 'üîÑ Sƒ±fƒ±rlandƒ±!')
        setTimeout(loadPreview, 1000)
      } catch (error) {
        alert('Hata: ' + error.message)
      }
    }

    async function deleteMatch(matchId) {
      if (!confirm('Bu ma√ßƒ± silmek istediƒüinizden emin misiniz?')) return

      try {
        const { error } = await adminSupabase.from('matches').delete().eq('id', matchId)
        if (error) throw error
        await loadMatches()
        setTimeout(loadPreview, 1000)
      } catch (error) {
        alert('Hata: ' + error.message)
      }
    }

    function showMatchMessage(matchId, text) {
      const msg = document.getElementById(`msg-${matchId}`)
      msg.textContent = text
      msg.style.display = 'block'
      setTimeout(() => msg.style.display = 'none', 3000)
    }

    async function loadPreview() {
      await Promise.all([loadPreviewDraw(), loadPreviewFixtures()])
    }

    async function loadPreviewDraw() {
      const { data } = await adminSupabase.from('draw').select('*').order('player_name')
      
      if (!data || data.length === 0) {
        document.getElementById('preview-draw').innerHTML = '<div style="text-align:center;color:#999;">Hen√ºz kura yapƒ±lmadƒ±</div>'
        return
      }
      
      const html = data.map(item => `
        <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          ${item.team_logo ? `<img src="${item.team_logo}" style="width: 50px; height: 50px; object-fit: contain; margin-bottom: 10px;" onerror="this.style.display='none'">` : ''}
          <div style="font-weight: 700; color: #0a2351; margin-bottom: 5px;">${item.player_name}</div>
          <div style="color: #1a4b8c; font-weight: 600;">${item.team_name}</div>
        </div>
      `).join('')
      
      document.getElementById('preview-draw').innerHTML = html
    }

    async function loadPreviewFixtures() {
      const { data } = await adminSupabase.from('matches').select('*').order('week_number, id').limit(10)
      
      if (!data || data.length === 0) {
        document.getElementById('preview-fixtures').innerHTML = '<div style="text-align:center;color:#999;">Hen√ºz ma√ß yok</div>'
        return
      }
      
      const html = data.map(match => {
        const hasScore = match.home_score !== null && match.away_score !== null
        const scoreText = hasScore ? `${match.home_score} - ${match.away_score}` : 'VS'
        
        return `
          <div style="background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
            <div>
              <strong style="color: #0a2351;">${match.home_team}</strong> 
              <span style="color: #999; margin: 0 8px;">${scoreText}</span>
              <strong style="color: #0a2351;">${match.away_team}</strong>
              <span style="color: #999; margin-left: 10px; font-size: 12px;">(Hafta ${match.week_number || 1})</span>
            </div>
          </div>
        `
      }).join('')
      
      document.getElementById('preview-fixtures').innerHTML = html
    }

    if (localStorage.getItem('admin-logged-in') === 'true') {
      adminSupabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY)
      showAdminPanel()
    }
  </script>
</body>
</html>
